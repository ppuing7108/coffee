<html>
  <body id="body" style="background: url('static/img/background.jpg') repeat center;" onload="timer();">
    <div style="width:9%;display: inline-block;">
      <p class="left_warning" style="position: absolute; top: 50px; left: 30px; color: red; text-align: center; font-size: 40px;">ì œ<br>ë°œ<br>ë‚´<br>ì´<br>ë¦„<br>ì´<br>í˜¸<br>ëª…<br>ë˜<br>ì§€<br>ì•Š<br>ê¸¸<br>ê¸°<br>ë„<br>í•´<br>ë¼</p>
    </div>
    <div style="width:80%;display:inline-block;">
      <h1 style="font-size:120px;text-align:center;margin-bottom:0;"> ğŸ’€<span style="color:red">ì£½ìŒì˜</span> <span style="color: blue">í˜¸</span><span style="color: green">ëª…</span><span style="color: red">ê¸°</span>ğŸ’€ </h1>
      <div id="setNumOfParticipants" style="text-align:center; margin-bototm: 5px;">
        <input id="numParticipants" type="text" value="" placeholder="ì°¸ê°€ì ìˆ˜ ì…ë ¥" style="height:30px;width:110px;">
        <input type="button" value="ë‹¤ìŒìœ¼ë¡œ" onclick="setParticipantNumbers();" style="height:30px;width:100px;">
      </div>

      <div id="addParticipant" style="text-align:center; margin-bottom: 5px; display: none;">
        <span id="participantsInputGroup"></span>
        <!--<input type="button" value="í˜•íƒœ" onclick="add('í˜•íƒœ', this);"  style="height:30px;width:60px;">
        <input type="button" value="íƒœê·œ" onclick="add('íƒœê·œ', this);"  style="height:30px;width:60px;">
        <input type="button" value="ì˜í™˜" onclick="add('ì˜í™˜', this);"  style="height:30px;width:60px;">
        <input type="button" value="ì§€ìŠ¹" onclick="add('ì§€ìŠ¹', this);"  style="height:30px;width:60px;">
        <input type="button" value="ì°½ì„ " onclick="add('ì°½ì„ ', this);"  style="height:30px;width:60px;">
        <input type="button" value="ì§€ì›…" onclick="add('ì§€ì›…', this);"  style="height:30px;width:60px;">
        <input type="button" value="ì„±í˜¸" onclick="add('ì„±í˜¸', this);"  style="height:30px;width:60px;">
        <input type="button" value="ì¢…ì°¬" onclick="add('ì¢…ì°¬', this);"  style="height:30px;width:60px;">
        <input type="button" value="ì§€ìš°" onclick="add('ì§€ìš°', this);"  style="height:30px;width:60px;">-->

        <input id="count" type="text" value="1" style="margin-left:50px;height:30px; width:30px;">
        <input type="button" value="ì‹œì‘í•˜ê¸°" onclick="start();" style="height:30px;width:100px;">
      </div>

      <div style="text-align: center;">
        <h1 id="participants" style="color: white; display: inline;"></h1>
        <h1 id="death_member" style="color: red; display: inline;"></h1>
      </div>

      <div id="game2" style="display: none; text-align: center;">
        <input id="next" type="button" value="Next" onclick="showNext();" style="height: 50px; width: 100px;display: none;">
        <div style="margin-top: 30px; margin-left: auto; margin-right: auto; font-size: 100px;">
          <h1 id="result_old" style="display: inline; margin-bottom: 15px; color: white;"></h1><h1 id="result" style="display: inline; color: cyan; margin-bottom: 15px;"></h1>
          <h3 id="message" style="display: none; margin-top: 15px; margin-bottom: 15px;color: red">ì»¤í”¼ ì‚¬ì™€ë¼.</h3>
          <input id="restart" type="button" value="ë‹¤ì‹œí•˜ê¸°" style="display: none; height: 50px; width: 100px;" onclick="restart();">
          <input id="resume" type="button" value="ê³„ì†ì§„í–‰" style="display: none; height: 50px; width: 100px;" onclick="resume();">
        </div>
      </div>
    </div>
    <div style="width:9%;display: inline-block;">
      <p class="right_warning" style="position: absolute; top: 50px; right: 30px; color: yellow; text-align: center; font-size: 40px;">ì•ˆ<br>ê±¸<br>ë¦¬<br>ë©´<br>ì»¤<br>í”¼<br>ì•ˆ<br>ì‚¬<br>ê³ <br>ê³µ<br>ì§œ<br>ë¡œ<br>ë¨¹<br>ëŠ”<br>ë‹¤</p>
    </div>

    <script>
      var participants = [];
      var deathMember = [];
      var result = "";
      var oldResult = "";
      var chars = "";
      var count = 1;
      let intervalFunc;
      var leftColor = "red";
      var rightColor = "yellow";
      var numOfParticipants = 2;
      var backgroundIndex = 0;
      var gameStatus = "ready"; // ready / playing / gameover

      function setParticipantNumbers() {
        numOfParticipants = document.getElementById("numParticipants").value;
        if (numOfParticipants < 2) {
          alert("ì°¸ê°€ìë¥¼ 2ëª… ì´ìƒ ì…ë ¥í•´ë¼..");
        }

        document.getElementById("setNumOfParticipants").style.display = "none";
        document.getElementById("addParticipant").style.display = "block";

        var inputGroup = document.getElementById("participantsInputGroup");
        // add Inputs in the participants form
        for (var i = 0; i < numOfParticipants; i++) {
            var input = document.createElement("input");
            input.style.height = "30px";
            input.style.width = "60px";
            input.classList.add("username");
            input.placeholder = "ì´ë¦„";
            inputGroup.appendChild(input);
        }
      }

      function timer() {
        setInterval(changeWarningColor, 1000);
        setInterval(changeBackground, 1000);
      }

      function changeWarningColor() {
        if (leftColor == "red") {
          leftColor = "yellow";
          rightColor = "red";
        } else {
          leftColor = "red";
          rightColor = "yellow";
        }
        var left = document.getElementsByClassName("left_warning")[0];
        var right = document.getElementsByClassName("right_warning")[0];
        left.style.color = leftColor;
        right.style.color = rightColor;
      }

      function changeBackground() {
        var body = document.getElementById("body");
        var backgrounds = ["background.jpg", "background-2.jpeg", "background-3.jpeg", "background-4.jpeg", "background-5.jpeg"];

        if (gameStatus == "playing") {
          backgroundIndex = (backgroundIndex + 1) % backgrounds.length;
          body.style.background = "url(static/img/" + backgrounds[backgroundIndex] + ") repeat center";
        }
        else if (gameStatus == "gameover") {
          body.style.background = "url(static/img/background-2.jpeg) repeat center";
        }
      }

      function add(name, event) {
        // event.style.display = "none";
        event.disabled = "disabled";
        if(name == "") {
          return;
        }
        participants.push(name);
        document.getElementById("participants").innerHTML = participants;
      }

      function start() {
        // create participants list, check empty value
        var inputs = document.getElementsByClassName("username");
        participants = [];
        for (var i = 0; i < numOfParticipants; i++) {
            name = inputs[i].value;
            if(name == undefined || name == null || name == "") {
              alert("ì°¸ê°€ì ì´ë¦„ì„ ì±„ì›Œì£¼ì„¸ìš”.");
              return;
            }

            participants.push(name);
        }
        document.getElementById("participants").innerHTML = participants;
        Array.from(inputs).forEach(input => {
          input.disabled = "disabled";
        })

        count = parseInt(document.getElementById("count").value);
        if (count >= participants.length || count <= 0) {
          return;
        }

        chars = participants.join("");
        if (chars == "") {
          return;
        }
        const unrepeated = (str) => [...new Set(str)].join('');
        chars = unrepeated(chars);

        document.getElementById("addParticipant").style.display = "none";
        document.getElementById("game2").style.display = "block";
        intervalFunc = setInterval(showNext, 1000);
        gameStatus = "playing";
      }

      function showNext() {
        var i = Math.floor(Math.random() * chars.length);
        result += chars[i];

        if (result.length > 2) {
          oldResult += result[0];
          result = result.substring(1);
        }
        if (oldResult.length > 4) {
          oldResult = oldResult.substring(1);
        }

        document.getElementById("result_old").innerText = oldResult;
        document.getElementById("result").innerText = result;

        if (participants.includes(result)) {
          // game over
          document.getElementById("result").innerText = "ğŸ‰" + result + "ğŸ‰";
          document.getElementById("result").style.color = "red";
          document.getElementById("next").disabled = "disabled";
          document.getElementById("message").style.display = "block";

          gameStatus = "gameover";
          deathMember.push(result);

          var idx = participants.indexOf(result);
          if (idx != -1) {
            participants.splice(idx, 1);
          }

          document.getElementById("death_member").innerText = "ğŸª¦" + deathMember + "ğŸª¦";
          document.getElementById("participants").innerHTML = participants;
          clearInterval(intervalFunc);
          intervalFunc = null;
          count -= 1;

          if (count <= 0) {
            document.getElementById("restart").style.display = "inline-block";
          } else {
            document.getElementById("resume").style.display = "inline-block";
            gameStatus = "playing";
          }
        }
      }

      function resume() {
        chars = participants.join("");
        if (chars == "") {
          return;
        }
        const unrepeated = (str) => [...new Set(str)].join('');
        chars = unrepeated(chars);

        document.getElementById("result").style.color = "cyan";
        document.getElementById("resume").style.display = "none";

        intervalFunc = setInterval(showNext, 1000);
      }

      function restart() {
        window.location.reload();
      }
    </script>
  </body>
</html>
